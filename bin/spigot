#!/usr/bin/env node

var nopt = require("nopt")
var path = require("path")
var knownOpts = {
  "parallel" : Boolean,
  "username" : String,
  "password" : String,
  "url" : String
};

var shortHands = {
  "u" : ["--username"],
  "p": ["--password"]
}

var parsed = nopt(knownOpts, shortHands, process.argv, 2)

var CommandProcessor = new require("../lib/command-processor.js");

if(parsed.argv.remain.length == 0) {
  console.log("Requires a data file");
  return;
}

var data = require(process.cwd() + "/" + parsed.argv.remain[0]);
var commandProcessor = new CommandProcessor(parsed.url, parsed.username, parsed.password);

if(parsed.parallel) {
  console.log('Executing in a parallel');
  commandProcessor.executeParallel(data);
}
else {
  console.log('Executing in a series');
  commandProcessor.executeSeries(data);
}
